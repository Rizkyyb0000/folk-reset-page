<script>
  async function submitPassword() {
    const token = new URLSearchParams(window.location.hash.substring(1)).get("access_token");
    const password = document.getElementById('password').value;
    const msg = document.getElementById('message');

    if (!token || !password) {
      msg.textContent = "Token atau password tidak valid.";
      msg.style.color = "red";
      return;
    }

    try {
      const res = await fetch('/api/update-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token, password })
      });

      let result = {};
      const contentType = res.headers.get("Content-Type") || "";
      const hasBody = contentType.includes("application/json");

      if (hasBody) {
        result = await res.json();
      }

      if (res.ok) {
        document.body.innerHTML = `
          <div style="color: lightgreen; text-align: center; padding: 40px;">
            <h2>Password berhasil diupdate.</h2>
            <p>Silakan kembali ke <strong>Folk Football Academy App</strong>.</p>
          </div>
        `;
      } else {
        msg.textContent = "Gagal: " + (result.message || result.error || "Terjadi kesalahan.");
        msg.style.color = "red";
      }
    } catch (e) {
      msg.textContent = "Terjadi kesalahan: " + e.message;
      msg.style.color = "red";
    }
  }
</script>
